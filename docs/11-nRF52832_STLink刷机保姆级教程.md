# nRF52832 åˆ·æœºä¿å§†çº§æ•™ç¨‹ (ST-Link ç‰ˆ)

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å‡ å—é’±ä¸€ä¸ªçš„ ST-Link V2 è°ƒè¯•å™¨ï¼Œè¯·çœ‹è¿™ä»½æ•™ç¨‹ã€‚
æœ¬æ•™ç¨‹å°†æ•™ä½ å¦‚ä½•ä½¿ç”¨ ST-Link ä¸º nRF52832 åˆ·å…¥ AirTag å›ºä»¶ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆä¸“å±å¯†é’¥ã€‚

## ğŸ›  å‡†å¤‡å·¥ä½œ

è¯·ç¡®ä¿ä½ æ‹¥æœ‰ï¼š

1. **nRF52832 å¼€å‘æ¿/æ¨¡å—**
2. **ST-Link V2 è°ƒè¯•å™¨** (é€šå¸¸é•¿å¾—åƒä¸ªUç›˜)
3. **4æ ¹æœé‚¦çº¿**
4. **Mac ç”µè„‘** (å·²å®‰è£… OpenOCDï¼Œå‚è€ƒ [ç¯å¢ƒå®‰è£…æŒ‡å—](01-ç¯å¢ƒå®‰è£…æŒ‡å—.md))

---

## ç¬¬ä¸€æ­¥ï¼šè¿æ¥ç¡¬ä»¶ ğŸ”Œ

ST-Link çš„æ¥çº¿ç¨å¾®æœ‰ç‚¹è®²ç©¶ï¼Œè¯·ä»”ç»†æ ¸å¯¹ã€‚

| ST-Link å¼•è„š | nRF52832 æ¨¡å— | è¯´æ˜ |
| :--- | :--- | :--- |
| **3.3V / VCC** | **VCC / VDD** | **ST-Link å¯ä»¥ç›´æ¥ä¾›ç”µ** |
| **GND** | **GND** | å¿…é¡»å…±åœ° |
| **SWDIO** | **SWDIO** | æ•°æ®çº¿ |
| **SWCLK** | **SWCLK** | æ—¶é’Ÿçº¿ |

> ğŸ’¡ **æç¤º**:
>
> 1. å¤§å¤šæ•° ST-Link V2 å¯ä»¥ç›´æ¥ç»™æ¨¡å—ä¾›ç”µï¼Œæ‰€ä»¥ä½ **ä¸éœ€è¦**é¢å¤–å†æ¥ç”µæ± ã€‚
> 2. åªæœ‰åœ¨ OpenOCD æŠ¥é”™ "Target voltage not detected" æ—¶ï¼Œæ‰éœ€è¦æ£€æŸ¥æ˜¯ä¸æ˜¯æ¨¡å—æ²¡ç”µã€‚

> âš ï¸ **é‡è¦è­¦å‘Š (å¿…è¯»)**:
> å¦‚æœä½ çš„ nRF52832 èŠ¯ç‰‡**æ›¾ç»åˆ·è¿‡å…¶ä»–å›ºä»¶**ä¸”è¢«é”ï¼ˆRead Protectedï¼‰ï¼ŒST-Link **æ— æ³•**è¿›è¡Œè§£é”ï¼ˆRecoverï¼‰ã€‚
>
> * **è¡¨ç°**: è„šæœ¬æç¤º `examination failed` æˆ– `Target not examined`ã€‚
> * **è§£å†³**: å¿…é¡»å€Ÿä¸€ä¸ª **J-Link** è¿è¡Œä¸€æ¬¡ `nrfjprog --recover` æˆ–ä½¿ç”¨æˆ‘ä»¬çš„ J-Link è„šæœ¬è¿›è¡Œåˆæ¬¡è§£é”ã€‚
> * **å…¨æ–°ç©ºèŠ¯ç‰‡**é€šå¸¸æ²¡æœ‰é”ï¼Œå¯ä»¥ç›´æ¥ç”¨ ST-Linkã€‚

---

## ç¬¬äºŒæ­¥ï¼šä¸€é”®åˆ·æœº ğŸš€

æˆ‘ä»¬ä¸ºä½ å‡†å¤‡äº† ST-Link ä¸“ç”¨çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç†ç¼–è¯‘ã€å¯†é’¥æ³¨å…¥å’Œçƒ§å½•ã€‚

1. **æ‰“å¼€ç»ˆç«¯**ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•ã€‚
2. **è¿è¡Œè„šæœ¬**:

```bash
./n52832autoflash_stlink.sh
```

1. **æŒ‰æç¤ºæ“ä½œ**:
    * **è®¾å¤‡å‰ç¼€**: ç»™è®¾å¤‡èµ·å (å¦‚ `TAG`)ã€‚
    * **èµ·å§‹ç¼–å·**: è¾“å…¥ `1`ã€‚
    * **åˆ·å†™ SoftDevice?**: é¦–æ¬¡åˆ·æœºå¿…é¡»é€‰ `y`ã€‚
    * **å¯ç”¨ DCDC?**: æ²¡ç”µæ„Ÿé€‰ `n`ï¼Œæœ‰ç”µæ„Ÿé€‰ `y` (ä¸ç¡®å®šå°±é€‰ `n`)ã€‚

2. **ç­‰å¾…å®Œæˆ**:
    è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ ST-Linkï¼Œå¦‚æœä½ çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„æ—¥å¿—ï¼Œè¯´æ˜æ­£åœ¨ç–¯ç‹‚å†™å…¥ï¼š

    ```text
    ğŸ”¥ æ­£åœ¨é€šè¿‡ OpenOCD åˆ·å†™...
    ...
    ** Verified OK **
    ```

    æœ€åçœ‹åˆ°ï¼š
    > ğŸ‰ğŸ‰ğŸ‰ è®¾å¤‡ TAG001 (nRF52832) æ“ä½œæˆåŠŸå®Œæˆï¼

---

## â“ å¸¸è§é—®é¢˜

### Q: æç¤º "Error: open failed" æˆ– "Transport error"

* **åŸå› **: OpenOCD æ²¡æ‰¾åˆ° ST-Linkã€‚
* **è§£å†³**: æ‹”æ‰ ST-Link é‡æ–°æ’ä¸€ä¸‹ USBã€‚

### Q: æç¤º "Target not examined yet"

* **åŸå› **: çº¿æ²¡æ¥å¥½ï¼Œæˆ–è€…æ¥è§¦ä¸è‰¯ã€‚
* **è§£å†³**: æ£€æŸ¥æœé‚¦çº¿ï¼Œç‰¹åˆ«æ˜¯ SWDIO å’Œ SWCLKã€‚

### Q: æç¤º "nRF52 device protected" (èŠ¯ç‰‡è¢«é”)

* **è§£å†³**: è„šæœ¬ä¼šè‡ªåŠ¨å°è¯•è§£é”ã€‚å¦‚æœå¤±è´¥ï¼Œä½ å¯ä»¥æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡å¼ºåŠ›è§£é”ï¼š

    ```bash
    openocd -f interface/stlink.cfg -f target/nrf52.cfg -c "init; nrf52 NOT_IMPLEMENTED_YET_CHECK_DOCS; exit"
    # ç­‰ç­‰ï¼ŒOpenOCD çš„è§£é”å‘½ä»¤æ˜¯:
    openocd -f interface/stlink.cfg -f target/nrf52.cfg -c "init; nrf5 mass_erase; exit"
    ```

    (æ³¨ï¼š`nrf5 mass_erase` å¯ä»¥æ¸…é™¤æ‰€æœ‰ä¿æŠ¤)

---

ç¥ä½ åˆ·æœºæ„‰å¿«ï¼ğŸš€

# nRF52810 é¡¹ç›®é…ç½®æ‰‹å†Œ

## ðŸ“‹ æ¦‚è¿°
æœ¬æ–‡æ¡£è¯´æ˜Žå¦‚ä½•é…ç½® heystack-nrf5x é¡¹ç›®å’Œ nRF5 SDKï¼ŒåŒ…æ‹¬è·¯å¾„è®¾ç½®å’Œå·¥å…·é“¾é…ç½®ã€‚

## ðŸ“¦ å¿…éœ€æ–‡ä»¶ä¸‹è½½

### 1. heystack-nrf5x é¡¹ç›®
```bash
cd ~/nrf52810_project
git clone https://github.com/pix/heystack-nrf5x.git
```

### 2. nRF5 SDK 15.3.0
**ä¸‹è½½åœ°å€**: https://www.nordicsemi.com/Software-and-tools/Software/nRF5-SDK

**æ–‡ä»¶å**: `nRF5_SDK_15.3.0_59ac345.zip`

**å®‰è£…æ­¥éª¤**:
```bash
cd ~/nrf52810_project/nrf-sdk
# ä¸‹è½½åŽè§£åŽ‹åˆ°æ­¤ç›®å½•
unzip ~/Downloads/nRF5_SDK_15.3.0_59ac345.zip
```

**éªŒè¯å®‰è£…**:
```bash
ls nrf-sdk/nRF5_SDK_15.3.0_59ac345/components/toolchain/gcc/
```

## ðŸ”§ å·¥å…·é“¾é…ç½®

### ä¿®æ”¹ Makefile.posix
ç¼–è¾‘æ–‡ä»¶: `nrf-sdk/nRF5_SDK_15.3.0_59ac345/components/toolchain/gcc/Makefile.posix`

**åŽŸå§‹å†…å®¹**:
```makefile
GNU_INSTALL_ROOT ?= /usr/local/gcc-arm-none-eabi-7-2018-q2-update/bin/
GNU_VERSION ?= 7.3.1
GNU_PREFIX ?= arm-none-eabi
```

**ä¿®æ”¹ä¸º** (Homebrew å®‰è£…çš„å·¥å…·é“¾):
```makefile
GNU_INSTALL_ROOT ?= /opt/homebrew/bin/
GNU_VERSION ?= 14.3.1
GNU_PREFIX ?= arm-none-eabi
```

## ðŸ“ é¡¹ç›®è·¯å¾„é…ç½®

### ä¿®æ”¹é¡¹ç›® Makefile
ç¼–è¾‘æ–‡ä»¶: `heystack-nrf5x/nrf52810/armgcc/Makefile`

**æ‰¾åˆ°ç¬¬5è¡Œ**:
```makefile
SDK_ROOT := $(NRF_ROOT)/nrf-sdk/nRF5_SDK_15.3.0_59ac345
```

**ä¿®æ”¹ä¸º**:
```makefile
SDK_ROOT := ../../../nrf-sdk/nRF5_SDK_15.3.0_59ac345
```

## ðŸ”‘ å¯†é’¥æ–‡ä»¶é…ç½®

### å¤åˆ¶å¯†é’¥æ–‡ä»¶
```bash
cp R0VVSW_keyfile heystack-nrf5x/nrf52810/armgcc/
```

### éªŒè¯å¯†é’¥æ–‡ä»¶
```bash
ls -la heystack-nrf5x/nrf52810/armgcc/R0VVSW_keyfile
```

## âš™ï¸ OpenOCD é…ç½®

### åˆ›å»ºé…ç½®æ–‡ä»¶
åœ¨ `heystack-nrf5x/nrf52810/armgcc/` ç›®å½•åˆ›å»º `openocd.cfg`:

```bash
cat > heystack-nrf5x/nrf52810/armgcc/openocd.cfg << 'EOF'
# ST-Link V2 æŽ¥å£é…ç½®
source [find interface/stlink.cfg]

# nRF52 ç›®æ ‡é…ç½®
source [find target/nrf52.cfg]

# è¿žæŽ¥é…ç½®
transport select hla_swd
adapter speed 1000

# åˆå§‹åŒ–
init
EOF
```

## ðŸ§ª é…ç½®éªŒè¯

### æµ‹è¯•ç¼–è¯‘çŽ¯å¢ƒ
```bash
cd heystack-nrf5x/nrf52810/armgcc

# æ¸…ç†
make clean

# æµ‹è¯•ç¼–è¯‘
make nrf52810_xxaa HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=300 MAX_KEYS=200 ADVERTISING_INTERVAL=2000
```

**æˆåŠŸæ ‡å¿—**:
- ç¼–è¯‘æ— é”™è¯¯
- ç”Ÿæˆ `_build/nrf52810_xxaa.hex` æ–‡ä»¶
- æ˜¾ç¤º "DONE nrf52810_xxaa"

### æµ‹è¯• ST-Link è¿žæŽ¥
```bash
# æ£€æµ‹ ST-Link ç¡¬ä»¶
openocd -f interface/stlink.cfg -f target/nrf52.cfg -c "init; targets; exit"
```

**é¢„æœŸç»“æžœ**:
- æ£€æµ‹åˆ° ST-Link è®¾å¤‡
- æ˜¾ç¤ºç›®æ ‡ç”µåŽ‹ (å¦‚æžœè¿žæŽ¥äº† nRF52810)

## ðŸ“‹ æ”¯æŒçš„è®¾å¤‡å’Œç›®æ ‡

### å¯ç”¨çš„ç¼–è¯‘ç›®æ ‡
- `nrf52810_xxaa`: åŸºæœ¬ç‰ˆæœ¬
- `nrf52810_xxaa-dcdc`: DC/DC ç‰ˆæœ¬ (æ›´çœç”µ)

### æ”¯æŒçš„å¼€å‘æ¿
- åŽŸè£… Tile Tag
- HolyIOT NRF52810 æ ‡ç­¾
- å…¶ä»–å…¼å®¹çš„ nRF52810 è®¾å¤‡

## ðŸ” æ•…éšœæŽ’é™¤

### å¸¸è§é”™è¯¯ 1: SDK è·¯å¾„é”™è¯¯
```
Makefile.common: No such file or directory
```
**è§£å†³**: æ£€æŸ¥ SDK_ROOT è·¯å¾„è®¾ç½®

### å¸¸è§é”™è¯¯ 2: å·¥å…·é“¾æœªæ‰¾åˆ°
```
arm-none-eabi-gcc: Command not found
```
**è§£å†³**: æ£€æŸ¥ Makefile.posix ä¸­çš„ GNU_INSTALL_ROOT

### å¸¸è§é”™è¯¯ 3: æƒé™é—®é¢˜
```
Permission denied
```
**è§£å†³**: æ£€æŸ¥æ–‡ä»¶æƒé™ï¼Œå¿…è¦æ—¶ä½¿ç”¨ chmod

## ðŸ“ é…ç½®æ£€æŸ¥æ¸…å•

é…ç½®å®ŒæˆåŽï¼Œç¡®ä¿ï¼š

- [ ] nRF5 SDK æ­£ç¡®è§£åŽ‹åˆ° nrf-sdk/ ç›®å½•
- [ ] Makefile.posix ä¸­å·¥å…·é“¾è·¯å¾„æ­£ç¡®
- [ ] é¡¹ç›® Makefile ä¸­ SDK_ROOT è·¯å¾„æ­£ç¡®
- [ ] å¯†é’¥æ–‡ä»¶å·²å¤åˆ¶åˆ°æ­£ç¡®ä½ç½®
- [ ] OpenOCD é…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] æµ‹è¯•ç¼–è¯‘æˆåŠŸ
- [ ] ST-Link ç¡¬ä»¶æ£€æµ‹æ­£å¸¸

## ðŸ“ ä¸‹ä¸€æ­¥

é…ç½®å®ŒæˆåŽï¼Œè¯·å‚è€ƒï¼š
- `03-å›ºä»¶ç¼–è¯‘æŒ‡å—.md` - äº†è§£ç¼–è¯‘è¿‡ç¨‹
- `04-ç¡¬ä»¶è¿žæŽ¥ä¸Žåˆ·å†™.md` - è¿žæŽ¥ç¡¬ä»¶å¹¶åˆ·å†™å›ºä»¶

---
*æœ€åŽæ›´æ–°: 2024å¹´7æœˆ*
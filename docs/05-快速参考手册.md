# nRF52810 å¿«é€Ÿå‚è€ƒæ‰‹å†Œ

## ğŸ“‹ æ¦‚è¿°
æœ¬æ–‡æ¡£æä¾›å¸¸ç”¨å‘½ä»¤ã€å‚æ•°é…ç½®å’Œæ•…éšœæ’é™¤çš„å¿«é€Ÿå‚è€ƒï¼Œé€‚åˆæ—¥å¸¸å¼€å‘ä½¿ç”¨ã€‚

## âš¡ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥å¼€å‘ç¯å¢ƒ
./setup_nrf52810.sh

# éªŒè¯å·¥å…·é“¾
arm-none-eabi-gcc --version
openocd --version
mergehex --version
python3 -c "import intelhex; print('intelhex OK')"
```

### ç¼–è¯‘å‘½ä»¤
åœ¨æ ¹ç›®å½•ä¸‹bash
____________________________________52832____________________________________
#### ä¸€é”®åˆ¶ä½œå¹¶åˆ·å†™
```bash
# æ ‡å‡†ç‰ˆæœ¬
make -C heystack-nrf5x/nrf51822/armgcc clean && make -C heystack-nrf5x/nrf52832/armgcc stflash-nrf52832_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=1010 ADV_KEYS_FILE=../../../config/BND001_keyfile

# DCDCç‰ˆæœ¬
make -C heystack-nrf5x/nrf51822/armgcc clean && make -C heystack-nrf5x/nrf52832/armgcc stflash-nrf52832_xxaa-dcdc-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2010 ADV_KEYS_FILE=../../../config/BND001_keyfile



_____________________________________________51822_____________________________________________
make -C heystack-nrf5x/nrf51822/armgcc clean && make -C heystack-nrf5x/nrf51822/armgcc stflash-nrf51822_xxac-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2030 ADV_KEYS_FILE=../../../config/MED003_keyfile

make -C heystack-nrf5x/nrf51822/armgcc clean && make -C heystack-nrf5x/nrf51822/armgcc stflash-nrf51822_xxac-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=1010 ADV_KEYS_FILE=../../../config/BND001_keyfile


make -C heystack-nrf5x/nrf51822/armgcc clean && make -C heystack-nrf5x/nrf51822/armgcc stflash-nrf51822_xxac-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2030 ADV_KEYS_FILE=../../../config/MSF003_keyfile




_____________________________________________52810/52811_____________________________________________
make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=5252 ADV_KEYS_FILE=../../../config/BU5252_keyfile
make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2295 ADV_KEYS_FILE=../../../config/BU2295_keyfile
make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2386 ADV_KEYS_FILE=../../../config/BU2386_keyfile
make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2662 ADV_KEYS_FILE=../../../config/BU2662_keyfile
make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=3423 ADV_KEYS_FILE=../../../config/BU3423_keyfile
make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=9576 ADV_KEYS_FILE=../../../config/BU9576_keyfile
make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2156 ADV_KEYS_FILE=../../../config/BU2156_keyfile




make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2119 ADV_KEYS_FILE=../../../config/MED001_keyfile

make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2800 ADV_KEYS_FILE=../../../config/LUO156_keyfile

make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=3900 ADV_KEYS_FILE=../../../config/LUO423_keyfile

make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=3700 ADV_KEYS_FILE=../../../config/LUO662_keyfile

make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=3500 ADV_KEYS_FILE=../../../config/LUO386_keyfile

make -C heystack-nrf5x/nrf52810/armgcc clean && make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=1 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2500 ADV_KEYS_FILE=../../../config/LUO252_keyfile
æˆ–è€…åˆ†å¼€æ‰§è¡Œ
make -C heystack-nrf5x/nrf52810/armgcc clean
make -C heystack-nrf5x/nrf52810/armgcc stflash-nrf52810_xxaa-patched HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=3500 ADV_KEYS_FILE=../../../config/LUO252_keyfile



```bash
cd heystack-nrf5x/nrf52810/armgcc

# æ¸…ç†ç¼–è¯‘æ–‡ä»¶
make clean

# åŸºç¡€ç¼–è¯‘ (æ— å¯†é’¥)
make nrf52810_xxaa HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2000

# å®Œæ•´ç¼–è¯‘ (å«å¯†é’¥)
make patched_nrf52810_xxaa HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2000 ADV_KEYS_FILE=./R0VVSW_keyfile

# ç¼–è¯‘+åˆ·å†™ (ä¸€æ­¥å®Œæˆ)
make stflash-nrf52810_xxaa-patched HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=2000 ADV_KEYS_FILE=./R0VVSW_keyfile
```
make stflash-nrf52810_xxaa-patched HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=5000 ADV_KEYS_FILE=./TZCX28_keyfile

make stflash-nrf52810_xxaa-patched HAS_DCDC=0 HAS_BATTERY=1 KEY_ROTATION_INTERVAL=900 MAX_KEYS=200 ADVERTISING_INTERVAL=3000 ADV_KEYS_FILE=./30L386_keyfile

### å¯†é’¥ç”Ÿæˆ
```bash
# å•ä¸ªè®¾å¤‡å¯†é’¥ç”Ÿæˆ
./scripts/generate_device_keys.sh DEV001 200

# æ‰¹é‡è®¾å¤‡å¯†é’¥ç”Ÿæˆ (æ¨è)
./scripts/batch_generate_device_keys.sh MED 20 200
# ç”Ÿæˆ MED001 åˆ° MED020 å…±20ä¸ªè®¾å¤‡ï¼Œæ¯ä¸ªè®¾å¤‡200ä¸ªå¯†é’¥

# äº¤äº’å¼æ‰¹é‡ç”Ÿæˆ
./scripts/batch_generate_device_keys.sh

# ä¸ºç°æœ‰å¯†é’¥æ–‡ä»¶æ·»åŠ ç»“å°¾æ ‡è®°
./scripts/add_marker_interactive.sh

# æŸ¥çœ‹æ‰€æœ‰è®¾å¤‡å¯†é’¥
./scripts/list_device_keys.sh
```

### ä¾¿æ·è„šæœ¬
```bash
# ä¸€é”®ç¼–è¯‘åˆ·å†™ (2ç§’å¹¿æ’­é—´éš”)
./compile_and_flash_2s.sh

# ç¯å¢ƒçŠ¶æ€æ£€æŸ¥
./setup_nrf52810.sh
```

### è°ƒè¯•å‘½ä»¤
```bash
# ç¼–è¯‘è°ƒè¯•ç‰ˆæœ¬
make stflash-nrf52810_xxaa-patched HAS_DEBUG=1 [å…¶ä»–å‚æ•°...]

# ç›‘æ§ RTT æ—¥å¿—
make rtt-monitor

# æµ‹è¯•ç¡¬ä»¶è¿æ¥
openocd -f openocd.cfg -c "init; targets; exit"
```

## ğŸ›ï¸ å‚æ•°é…ç½®è¡¨

### åŸºç¡€å‚æ•°
| å‚æ•° | å€¼ | è¯´æ˜ | æ¨èè®¾ç½® |
|------|----|----- |----------|
| `HAS_DCDC` | 0/1 | ç¨³å‹å™¨ç±»å‹ | 0 (LDO, æ›´å…¼å®¹) |
| `HAS_BATTERY` | 0/1 | ç”µé‡æŠ¥å‘Š | 1 (å¯ç”¨) |
| `HAS_DEBUG` | 0/1 | è°ƒè¯•æ¨¡å¼ | 0 (æ­£å¼), 1 (è°ƒè¯•) |

### åŠŸèƒ½å‚æ•°
| å‚æ•° | èŒƒå›´ | å•ä½ | è¯´æ˜ | æ¨èå€¼ |
|------|------|------|------|--------|
| `KEY_ROTATION_INTERVAL` | 60-3600 | ç§’ | å¯†é’¥è½®æ¢é—´éš” | 300 (5åˆ†é’Ÿ) |
| `MAX_KEYS` | 50-500 | ä¸ª | æœ€å¤§å¯†é’¥æ•°é‡ | 200 |
| `ADVERTISING_INTERVAL` | 100-10000 | æ¯«ç§’ | å¹¿æ’­é—´éš” | 2000 (2ç§’) |

### å¹¿æ’­é—´éš”å¯¹ç…§è¡¨
| é—´éš”(ms) | é¢‘ç‡ | ç”µæ± å¯¿å‘½ | å“åº”é€Ÿåº¦ | é€‚ç”¨åœºæ™¯ |
|----------|------|----------|----------|----------|
| 1000 | 1æ¬¡/ç§’ | ä¸­ç­‰ | å¿« | æµ‹è¯•å¼€å‘ |
| 2000 | 1æ¬¡/2ç§’ | å¥½ | ä¸­ç­‰ | æ—¥å¸¸ä½¿ç”¨ |
| 5000 | 1æ¬¡/5ç§’ | å¾ˆå¥½ | æ…¢ | é•¿æœŸéƒ¨ç½² |
| 10000 | 1æ¬¡/10ç§’ | æå¥½ | å¾ˆæ…¢ | è¶…é•¿å¾…æœº |

### æ‰¹é‡å¯†é’¥ç”Ÿæˆå‚æ•°è¡¨
| å‚æ•° | æ ¼å¼ | èŒƒå›´ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| `å‰ç¼€` | 3ä½å¤§å†™å­—æ¯ | A-Z | è®¾å¤‡ç±»å‹æ ‡è¯† | MED, DEV, TAG |
| `è®¾å¤‡æ•°é‡` | æ•°å­— | 1-100 | æ‰¹é‡ç”Ÿæˆçš„è®¾å¤‡æ•° | 20 |
| `æ¯è®¾å¤‡å¯†é’¥æ•°` | æ•°å­— | 1-500 | æ¯ä¸ªè®¾å¤‡çš„å¯†é’¥æ•°é‡ | 200 |

### æ‰¹é‡ç”Ÿæˆç¤ºä¾‹
| å‘½ä»¤ | ç”Ÿæˆç»“æœ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|
| `./scripts/batch_generate_device_keys.sh MED 5 100` | MED001-MED005, æ¯ä¸ª100å¯†é’¥ | å°æ‰¹é‡æµ‹è¯• |
| `./scripts/batch_generate_device_keys.sh DEV 20 200` | DEV001-DEV020, æ¯ä¸ª200å¯†é’¥ | ä¸­ç­‰è§„æ¨¡éƒ¨ç½² |
| `./scripts/batch_generate_device_keys.sh TAG 50 300` | TAG001-TAG050, æ¯ä¸ª300å¯†é’¥ | å¤§è§„æ¨¡ç”Ÿäº§ |

## ğŸ“ æ–‡ä»¶è·¯å¾„é€ŸæŸ¥

### é‡è¦æ–‡ä»¶ä½ç½®
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ heystack-nrf5x/
â”‚   â”œâ”€â”€ nrf52810/armgcc/
â”‚   â”‚   â”œâ”€â”€ Makefile                    # é¡¹ç›®é…ç½®
â”‚   â”‚   â”œâ”€â”€ openocd.cfg                 # OpenOCD é…ç½®
â”‚   â”‚   â”œâ”€â”€ R0VVSW_keyfile             # å¯†é’¥æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ _build/                     # ç¼–è¯‘è¾“å‡º
â”‚   â”‚       â”œâ”€â”€ nrf52810_xxaa.hex      # åº”ç”¨ç¨‹åº
â”‚   â”‚       â”œâ”€â”€ nrf52810_xxaa_s112.hex # å®Œæ•´å›ºä»¶
â”‚   â”‚       â””â”€â”€ nrf52810_xxaa_s112_patched.bin # æœ€ç»ˆå›ºä»¶
â”œâ”€â”€ nrf-sdk/
â”‚   â””â”€â”€ nRF5_SDK_15.3.0_59ac345/
â”‚       â””â”€â”€ components/toolchain/gcc/
â”‚           â””â”€â”€ Makefile.posix          # å·¥å…·é“¾é…ç½®
â”œâ”€â”€ setup_nrf52810.sh                  # ç¯å¢ƒæ£€æŸ¥è„šæœ¬
â””â”€â”€ compile_and_flash_2s.sh            # ç¼–è¯‘åˆ·å†™è„šæœ¬
```

### é…ç½®æ–‡ä»¶å¿«é€Ÿç¼–è¾‘
```bash
# ç¼–è¾‘å·¥å…·é“¾é…ç½®
nano nrf-sdk/nRF5_SDK_15.3.0_59ac345/components/toolchain/gcc/Makefile.posix

# ç¼–è¾‘é¡¹ç›®é…ç½®
nano heystack-nrf5x/nrf52810/armgcc/Makefile

# ç¼–è¾‘ OpenOCD é…ç½®
nano heystack-nrf5x/nrf52810/armgcc/openocd.cfg
```

## ğŸš¨ æ•…éšœæ’é™¤é€ŸæŸ¥

### ç¼–è¯‘é”™è¯¯
| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|
| `arm-none-eabi-gcc: Command not found` | å·¥å…·é“¾è·¯å¾„é”™è¯¯ | æ£€æŸ¥ Makefile.posix |
| `Makefile.common: No such file` | SDK è·¯å¾„é”™è¯¯ | æ£€æŸ¥é¡¹ç›® Makefile |
| `mergehex: No such file or directory` | Nordic å·¥å…·æœªå®‰è£… | `brew install --cask nordic-nrf-command-line-tools` |
| `hex2bin.py: No such file or directory` | Python å·¥å…·ç¼ºå¤± | `pip3 install intelhex` |
| `R0VVSW_keyfile does not exist` | å¯†é’¥æ–‡ä»¶ç¼ºå¤± | å¤åˆ¶å¯†é’¥æ–‡ä»¶åˆ°æ­£ç¡®ä½ç½® |
| `The key was not patched correctly!` | å¯†é’¥è¡¥ä¸å¤±è´¥ | æ£€æŸ¥å¯†é’¥æ–‡ä»¶æ ¼å¼å’Œå†…å®¹ |

### å¯†é’¥ç”Ÿæˆé”™è¯¯
| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|
| `å‰ç¼€å¿…é¡»æ˜¯3ä½å¤§å†™å­—æ¯` | å‰ç¼€æ ¼å¼é”™è¯¯ | ä½¿ç”¨å¦‚ MED, DEV, TAG æ ¼å¼ |
| `è®¾å¤‡æ•°é‡å¿…é¡»æ˜¯ 1-100 ä¹‹é—´çš„æ•°å­—` | æ•°é‡è¶…å‡ºèŒƒå›´ | è°ƒæ•´è®¾å¤‡æ•°é‡åˆ°åˆç†èŒƒå›´ |
| `ç¼ºå°‘ Python cryptography åº“` | ä¾èµ–åº“æœªå®‰è£… | `pip3 install cryptography` |
| `æœªæ‰¾åˆ° generate_keys.py è„šæœ¬` | å·¥å…·è„šæœ¬ç¼ºå¤± | æ£€æŸ¥é¡¹ç›®å®Œæ•´æ€§ |
| `è®¾å¤‡ XXX å¯†é’¥ç”Ÿæˆå¤±è´¥` | å•ä¸ªè®¾å¤‡ç”Ÿæˆå¤±è´¥ | æ£€æŸ¥ç£ç›˜ç©ºé—´å’Œæƒé™ |
| `æ£€æµ‹åˆ°ç°æœ‰æ–‡ä»¶` | æ–‡ä»¶å·²å­˜åœ¨ | é€‰æ‹©è¦†ç›–æˆ–æ›´æ”¹è®¾å¤‡åç§° |

### è¿æ¥é”™è¯¯
| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|
| `unable to connect to the target` | ç¡¬ä»¶æœªè¿æ¥ | æ£€æŸ¥è¿æ¥çº¿ |
| `Target voltage: 0.000000` | ç”µæºé—®é¢˜ | æ£€æŸ¥ 3.3V å’Œ GND |
| `STLINK not found` | ST-Link æœªæ£€æµ‹ | æ£€æŸ¥ USB è¿æ¥ |

### åˆ·å†™é”™è¯¯
| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|
| `Programming failed` | èŠ¯ç‰‡ä¿æŠ¤/è¿æ¥é—®é¢˜ | å°è¯• mass_erase |
| `Verification failed` | åˆ·å†™ä¸å®Œæ•´ | é‡æ–°åˆ·å†™ |
| `Flash write error` | ç¡¬ä»¶é—®é¢˜ | æ£€æŸ¥è¿æ¥ç¨³å®šæ€§ |

## ğŸ”§ å¸¸ç”¨æ“ä½œæµç¨‹

### é¦–æ¬¡ç¯å¢ƒæ­å»º
1. å®‰è£…å¼€å‘å·¥å…· â†’ `01-ç¯å¢ƒå®‰è£…æŒ‡å—.md`
2. ä¸‹è½½é…ç½®é¡¹ç›® â†’ `02-é¡¹ç›®é…ç½®æ‰‹å†Œ.md`
3. æµ‹è¯•ç¼–è¯‘ â†’ `make nrf52810_xxaa`
4. è¿æ¥ç¡¬ä»¶ â†’ `04-ç¡¬ä»¶è¿æ¥ä¸åˆ·å†™.md`
5. åˆ·å†™å›ºä»¶ â†’ `./compile_and_flash_2s.sh`

### æ—¥å¸¸å¼€å‘æµç¨‹
1. ä¿®æ”¹å‚æ•° â†’ ç¼–è¾‘ make å‘½ä»¤
2. ç¼–è¯‘æµ‹è¯• â†’ `make patched_nrf52810_xxaa`
3. åˆ·å†™éªŒè¯ â†’ `make stflash-nrf52810_xxaa-patched`
4. è°ƒè¯•ç›‘æ§ â†’ `make rtt-monitor`

### æ‰¹é‡è®¾å¤‡éƒ¨ç½²æµç¨‹
1. æ‰¹é‡ç”Ÿæˆå¯†é’¥ â†’ `./scripts/batch_generate_device_keys.sh MED 20 200`
2. éªŒè¯å¯†é’¥æ–‡ä»¶ â†’ `./scripts/list_device_keys.sh`
3. æ‰¹é‡ç¼–è¯‘åˆ·å†™ â†’ å¾ªç¯æ‰§è¡Œ `./scripts/compile_and_flash_device.sh`
4. è®¾å¤‡åŠŸèƒ½æµ‹è¯• â†’ ä½¿ç”¨ AirTag åº”ç”¨éªŒè¯

### é—®é¢˜æ’æŸ¥æµç¨‹
1. æ£€æŸ¥ç¯å¢ƒ â†’ `./setup_nrf52810.sh`
2. æµ‹è¯•ç¼–è¯‘ â†’ `make clean && make nrf52810_xxaa`
3. æµ‹è¯•è¿æ¥ â†’ `openocd -f openocd.cfg -c "init; exit"`
4. æŸ¥çœ‹æ—¥å¿— â†’ åˆ†æé”™è¯¯ä¿¡æ¯
5. å‚è€ƒæ–‡æ¡£ â†’ å¯¹åº”æ•…éšœæ’é™¤ç« èŠ‚

## ğŸ“Š æ€§èƒ½è°ƒä¼˜å‚è€ƒ

### ç”µæ± å¯¿å‘½ä¼˜å…ˆ
```bash
make stflash-nrf52810_xxaa-patched \
    HAS_DCDC=1 \
    HAS_BATTERY=1 \
    KEY_ROTATION_INTERVAL=600 \
    MAX_KEYS=100 \
    ADVERTISING_INTERVAL=5000 \
    ADV_KEYS_FILE=./R0VVSW_keyfile
```

### å“åº”é€Ÿåº¦ä¼˜å…ˆ
```bash
make stflash-nrf52810_xxaa-patched \
    HAS_DCDC=0 \
    HAS_BATTERY=1 \
    KEY_ROTATION_INTERVAL=180 \
    MAX_KEYS=300 \
    ADVERTISING_INTERVAL=1000 \
    ADV_KEYS_FILE=./R0VVSW_keyfile
```

### è°ƒè¯•å¼€å‘ç‰ˆæœ¬
```bash
make stflash-nrf52810_xxaa-patched \
    HAS_DEBUG=1 \
    HAS_DCDC=0 \
    HAS_BATTERY=1 \
    KEY_ROTATION_INTERVAL=60 \
    MAX_KEYS=50 \
    ADVERTISING_INTERVAL=1000 \
    ADV_KEYS_FILE=./R0VVSW_keyfile
```

## ğŸ” è°ƒè¯•æŠ€å·§

### RTT æ—¥å¿—åˆ†æ
```bash
# å¯åŠ¨æ—¥å¿—ç›‘æ§
make rtt-monitor

# å¸¸è§æ—¥å¿—ä¿¡æ¯
<info> app: Starting advertising        # å¼€å§‹å¹¿æ’­
<info> app: ble_set_mac_address: XX:XX  # è®¾ç½® MAC åœ°å€
<info> app: Rotating key: N             # å¯†é’¥è½®æ¢
<info> app: Battery level: XX           # ç”µé‡ä¿¡æ¯
```

### è¿æ¥çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥ ST-Link è®¾å¤‡
system_profiler SPUSBDataType | grep -i stlink

# æ£€æŸ¥ç›®æ ‡ç”µå‹
openocd -f openocd.cfg -c "init; targets; exit" 2>&1 | grep voltage
```

### å›ºä»¶ä¿¡æ¯æŸ¥çœ‹
```bash
# æŸ¥çœ‹ç¼–è¯‘è¾“å‡ºå¤§å°
ls -lh _build/nrf52810_xxaa*

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
arm-none-eabi-size _build/nrf52810_xxaa.out

# éªŒè¯ hex æ–‡ä»¶
mergehex --verify _build/nrf52810_xxaa_s112.hex

# æ£€æŸ¥å¯†é’¥è¡¥ä¸
xxd -s 112472 -l 32 _build/nrf52810_xxaa_s112_patched.bin
```

## ğŸ“± è®¾å¤‡å…¼å®¹æ€§

### æ”¯æŒçš„ nRF52810 è®¾å¤‡
- âœ… åŸè£… Tile Tag
- âœ… HolyIOT NRF52810 æ ‡ç­¾
- âœ… è‡ªåˆ¶ nRF52810 å¼€å‘æ¿
- âœ… Nordic nRF52810-DK

### æ”¯æŒçš„è°ƒè¯•å™¨
- âœ… ST-Link V2
- âœ… ST-Link V3
- âœ… Black Magic Probe
- âœ… J-Link (éœ€è¦é¢å¤–é…ç½®)

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£å‚è€ƒé¡ºåº
1. æœ¬å¿«é€Ÿå‚è€ƒæ‰‹å†Œ (å¸¸è§é—®é¢˜)
2. å¯¹åº”è¯¦ç»†æ–‡æ¡£ (æ·±å…¥äº†è§£)
3. GitHub é¡¹ç›®é¡µé¢ (æœ€æ–°ä¿¡æ¯)
4. Nordic å®˜æ–¹æ–‡æ¡£ (æŠ€æœ¯ç»†èŠ‚)

### å¸¸ç”¨èµ„æºé“¾æ¥
- [heystack-nrf5x GitHub](https://github.com/pix/heystack-nrf5x)
- [nRF5 SDK æ–‡æ¡£](https://infocenter.nordicsemi.com/index.jsp)
- [OpenOCD æ–‡æ¡£](http://openocd.org/doc/)

---
*æœ€åæ›´æ–°: 2024å¹´7æœˆ*
